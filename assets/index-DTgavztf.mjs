function t(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var e,r=(e=import.meta.url,async function(t={}){var r,n,i=t;i.ready=new Promise(((t,e)=>{r=t,n=e}));var o,s,a,c=Object.assign({},i),_="object"==typeof window,u="function"==typeof importScripts,A="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,f="";if(A){const{createRequire:t}=await Promise.resolve().then((()=>g));var h=t(import.meta.url),l=h("fs"),R=h("path");f=u?R.dirname(f)+"/":h("url").fileURLToPath(new URL("./",import.meta.url)),o=(t,e)=>(t=U(t)?new URL(t):R.normalize(t),l.readFileSync(t,e?void 0:"utf8")),a=t=>{var e=o(t,!0);return e.buffer||(e=new Uint8Array(e)),e},s=(t,e,r,n=!0)=>{t=U(t)?new URL(t):R.normalize(t),l.readFile(t,n?void 0:"utf8",((t,i)=>{t?r(t):e(n?i.buffer:i)}))},!i.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),i.inspect=()=>"[Emscripten Module object]"}else(_||u)&&(u?f=self.location.href:"undefined"!=typeof document&&document.currentScript&&(f=document.currentScript.src),e&&(f=e),f=0!==f.indexOf("blob:")?f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},u&&(a=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),s=(t,e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?e(n.response):r()},n.onerror=r,n.send(null)});var d,m,p,y=i.print||console.log.bind(console),B=i.printErr||console.error.bind(console);Object.assign(i,c),c=null,i.arguments&&i.arguments,i.thisProgram&&i.thisProgram,i.quit&&i.quit,i.wasmBinary&&(d=i.wasmBinary),i.noExitRuntime,"object"!=typeof WebAssembly&&P("no native wasm support detected");var E,I,v=!1;function Z(){var t=m.buffer;i.HEAP8=new Int8Array(t),i.HEAP16=new Int16Array(t),i.HEAP32=new Int32Array(t),i.HEAPU8=E=new Uint8Array(t),i.HEAPU16=new Uint16Array(t),i.HEAPU32=I=new Uint32Array(t),i.HEAPF32=new Float32Array(t),i.HEAPF64=new Float64Array(t)}var b=[],C=[],N=[],S=0,w=null;function P(t){i.onAbort&&i.onAbort(t),B(t="Aborted("+t+")"),v=!0,t+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(t);throw n(e),e}var T,O,D="data:application/octet-stream;base64,";function F(t){return t.startsWith(D)}function U(t){return t.startsWith("file://")}function H(t){if(t==T&&d)return new Uint8Array(d);if(a)return a(t);throw"both async and sync fetching of the wasm failed"}function G(t,e,r){return function(t){if(!d&&(_||u)){if("function"==typeof fetch&&!U(t))return fetch(t,{credentials:"same-origin"}).then((e=>{if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})).catch((()=>H(t)));if(s)return new Promise(((e,r)=>{s(t,(t=>e(new Uint8Array(t))),r)}))}return Promise.resolve().then((()=>H(t)))}(t).then((t=>WebAssembly.instantiate(t,e))).then((t=>t)).then(r,(t=>{B("failed to asynchronously prepare wasm: "+t),P(t)}))}i.locateFile?F(T="zbar.wasm")||(O=T,T=i.locateFile?i.locateFile(O,f):f+O):T=new URL("zbar.wasm",import.meta.url).href;var L,M=t=>{for(;t.length>0;)t.shift()(i)},x=t=>{var e=t-m.buffer.byteLength+65535>>>16;try{return m.grow(e),Z(),1}catch(t){}},W="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,k=[null,[],[]],Y=(t,e)=>{var r=k[t];0===e||10===e?((1===t?y:B)(((t,e,r)=>{for(var n=e+r,i=e;t[i]&&!(i>=n);)++i;if(i-e>16&&t.buffer&&W)return W.decode(t.subarray(e,i));for(var o="";e<i;){var s=t[e++];if(128&s){var a=63&t[e++];if(192!=(224&s)){var c=63&t[e++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&t[e++])<65536)o+=String.fromCharCode(s);else{var _=s-65536;o+=String.fromCharCode(55296|_>>10,56320|1023&_)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o})(r,0)),r.length=0):r.push(e)},j={d:()=>!0,e:function(){return Date.now()},c:t=>{var e=E.length,r=2147483648;if((t>>>=0)>r)return!1;for(var n,i,o=1;o<=4;o*=2){var s=e*(1+.2/o);s=Math.min(s,t+100663296);var a=Math.min(r,(n=Math.max(t,s))+((i=65536)-n%i)%i);if(x(a))return!0}return!1},f:t=>52,b:function(t,e,r,n,i){return 70},a:(t,e,r,n)=>{for(var i=0,o=0;o<r;o++){var s=I[e>>2],a=I[e+4>>2];e+=8;for(var c=0;c<a;c++)Y(t,E[s+c]);i+=a}return I[n>>2]=i,0}};function q(){function t(){L||(L=!0,i.calledRun=!0,v||(M(C),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)t=i.postRun.shift(),N.unshift(t);var t;M(N)}()))}S>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)t=i.preRun.shift(),b.unshift(t);var t;M(b)}(),S>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(function(){var t,e,r,o,s={a:j};function a(t,e){var r,n=t.exports;return m=(p=n).g,Z(),p.s,r=p.h,C.unshift(r),function(t){if(S--,i.monitorRunDependencies&&i.monitorRunDependencies(S),0==S&&w){var e=w;w=null,e()}}(),n}if(S++,i.monitorRunDependencies&&i.monitorRunDependencies(S),i.instantiateWasm)try{return i.instantiateWasm(s,a)}catch(t){B("Module.instantiateWasm callback failed with error: "+t),n(t)}(t=d,e=T,r=s,o=function(t){a(t.instance)},t||"function"!=typeof WebAssembly.instantiateStreaming||F(e)||U(e)||A||"function"!=typeof fetch?G(e,r,o):fetch(e,{credentials:"same-origin"}).then((t=>WebAssembly.instantiateStreaming(t,r).then(o,(function(t){return B("wasm streaming compile failed: "+t),B("falling back to ArrayBuffer instantiation"),G(e,r,o)}))))).catch(n)}(),i._ImageScanner_create=()=>(i._ImageScanner_create=p.i)(),i._ImageScanner_destory=t=>(i._ImageScanner_destory=p.j)(t),i._ImageScanner_set_config=(t,e,r,n)=>(i._ImageScanner_set_config=p.k)(t,e,r,n),i._ImageScanner_enable_cache=(t,e)=>(i._ImageScanner_enable_cache=p.l)(t,e),i._ImageScanner_recycle_image=(t,e)=>(i._ImageScanner_recycle_image=p.m)(t,e),i._ImageScanner_get_results=t=>(i._ImageScanner_get_results=p.n)(t),i._ImageScanner_scan=(t,e)=>(i._ImageScanner_scan=p.o)(t,e),i._Image_create=(t,e,r,n,o,s)=>(i._Image_create=p.p)(t,e,r,n,o,s),i._Image_destory=t=>(i._Image_destory=p.q)(t),i._Image_get_symbols=t=>(i._Image_get_symbols=p.r)(t),i._free=t=>(i._free=p.t)(t),i._malloc=t=>(i._malloc=p.u)(t),w=function t(){L||q(),L||(w=t)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return q(),t.ready});let n;const i=t(void 0,void 0,void 0,(function*(){if(n=yield r(),!n)throw Error("WASM was not loaded");return n})),o=()=>t(void 0,void 0,void 0,(function*(){return yield i}));var s,a,c;!function(t){t[t.ZBAR_NONE=0]="ZBAR_NONE",t[t.ZBAR_PARTIAL=1]="ZBAR_PARTIAL",t[t.ZBAR_EAN2=2]="ZBAR_EAN2",t[t.ZBAR_EAN5=5]="ZBAR_EAN5",t[t.ZBAR_EAN8=8]="ZBAR_EAN8",t[t.ZBAR_UPCE=9]="ZBAR_UPCE",t[t.ZBAR_ISBN10=10]="ZBAR_ISBN10",t[t.ZBAR_UPCA=12]="ZBAR_UPCA",t[t.ZBAR_EAN13=13]="ZBAR_EAN13",t[t.ZBAR_ISBN13=14]="ZBAR_ISBN13",t[t.ZBAR_COMPOSITE=15]="ZBAR_COMPOSITE",t[t.ZBAR_I25=25]="ZBAR_I25",t[t.ZBAR_DATABAR=34]="ZBAR_DATABAR",t[t.ZBAR_DATABAR_EXP=35]="ZBAR_DATABAR_EXP",t[t.ZBAR_CODABAR=38]="ZBAR_CODABAR",t[t.ZBAR_CODE39=39]="ZBAR_CODE39",t[t.ZBAR_PDF417=57]="ZBAR_PDF417",t[t.ZBAR_QRCODE=64]="ZBAR_QRCODE",t[t.ZBAR_SQCODE=80]="ZBAR_SQCODE",t[t.ZBAR_CODE93=93]="ZBAR_CODE93",t[t.ZBAR_CODE128=128]="ZBAR_CODE128",t[t.ZBAR_SYMBOL=255]="ZBAR_SYMBOL",t[t.ZBAR_ADDON2=512]="ZBAR_ADDON2",t[t.ZBAR_ADDON5=1280]="ZBAR_ADDON5",t[t.ZBAR_ADDON=1792]="ZBAR_ADDON"}(s||(s={})),function(t){t[t.ZBAR_CFG_ENABLE=0]="ZBAR_CFG_ENABLE",t[t.ZBAR_CFG_ADD_CHECK=1]="ZBAR_CFG_ADD_CHECK",t[t.ZBAR_CFG_EMIT_CHECK=2]="ZBAR_CFG_EMIT_CHECK",t[t.ZBAR_CFG_ASCII=3]="ZBAR_CFG_ASCII",t[t.ZBAR_CFG_BINARY=4]="ZBAR_CFG_BINARY",t[t.ZBAR_CFG_NUM=5]="ZBAR_CFG_NUM",t[t.ZBAR_CFG_MIN_LEN=32]="ZBAR_CFG_MIN_LEN",t[t.ZBAR_CFG_MAX_LEN=33]="ZBAR_CFG_MAX_LEN",t[t.ZBAR_CFG_UNCERTAINTY=64]="ZBAR_CFG_UNCERTAINTY",t[t.ZBAR_CFG_POSITION=128]="ZBAR_CFG_POSITION",t[t.ZBAR_CFG_TEST_INVERTED=129]="ZBAR_CFG_TEST_INVERTED",t[t.ZBAR_CFG_X_DENSITY=256]="ZBAR_CFG_X_DENSITY",t[t.ZBAR_CFG_Y_DENSITY=257]="ZBAR_CFG_Y_DENSITY"}(a||(a={})),function(t){t[t.ZBAR_ORIENT_UNKNOWN=-1]="ZBAR_ORIENT_UNKNOWN",t[t.ZBAR_ORIENT_UP=0]="ZBAR_ORIENT_UP",t[t.ZBAR_ORIENT_RIGHT=1]="ZBAR_ORIENT_RIGHT",t[t.ZBAR_ORIENT_DOWN=2]="ZBAR_ORIENT_DOWN",t[t.ZBAR_ORIENT_LEFT=3]="ZBAR_ORIENT_LEFT"}(c||(c={}));class _{constructor(t,e){this.ptr=t,this.inst=e}checkAlive(){if(!this.ptr)throw Error("Call after destroyed")}getPointer(){return this.checkAlive(),this.ptr}}class u{constructor(t,e){this.ptr=t,this.ptr32=t>>2,this.buf=e,this.HEAP8=new Int8Array(e),this.HEAPU32=new Uint32Array(e),this.HEAP32=new Int32Array(e)}}class A extends u{get type(){return this.HEAPU32[this.ptr32]}get data(){const t=this.HEAPU32[this.ptr32+4],e=this.HEAPU32[this.ptr32+5];return Int8Array.from(this.HEAP8.subarray(e,e+t))}get points(){const t=this.HEAPU32[this.ptr32+7],e=this.HEAPU32[this.ptr32+8]>>2,r=[];for(let n=0;n<t;++n){const t=this.HEAP32[e+2*n],i=this.HEAP32[e+2*n+1];r.push({x:t,y:i})}return r}get orientation(){return this.HEAP32[this.ptr32+9]}get next(){const t=this.HEAPU32[this.ptr32+11];return t?new A(t,this.buf):null}get time(){return this.HEAPU32[this.ptr32+13]}get cacheCount(){return this.HEAP32[this.ptr32+14]}get quality(){return this.HEAP32[this.ptr32+15]}}class f extends u{get head(){const t=this.HEAPU32[this.ptr32+2];return t?new A(t,this.buf):null}}class h{constructor(t){this.type=t.type,this.typeName=s[this.type],this.data=t.data,this.points=t.points,this.orientation=t.orientation,this.time=t.time,this.cacheCount=t.cacheCount,this.quality=t.quality}static createSymbolsFromPtr(t,e){if(0==t)return[];let r=new f(t,e).head;const n=[];for(;null!==r;)n.push(new h(r)),r=r.next;return n}decode(t){return new TextDecoder(t).decode(this.data)}}class l extends _{static createFromGrayBuffer(e,r,n,i=0){return t(this,void 0,void 0,(function*(){const t=yield o(),s=new Uint8Array(n),a=e*r;if(a!==s.byteLength)throw Error(`data length (${s.byteLength} bytes) does not match width and height (${a} bytes)`);const c=t._malloc(a);t.HEAPU8.set(s,c);return new this(t._Image_create(e,r,808466521,c,a,i),t)}))}static createFromRGBABuffer(e,r,n,i=0){return t(this,void 0,void 0,(function*(){const t=yield o(),s=new Uint8Array(n),a=e*r;if(4*a!==s.byteLength)throw Error(`data length (${s.byteLength} bytes) does not match width and height (${4*a} bytes)`);const c=t._malloc(a),_=c+a,u=t.HEAPU8;for(let t=c,e=0;t<_;t++,e+=4)u[t]=19595*s[e]+38469*s[e+1]+7472*s[e+2]>>16;return new this(t._Image_create(e,r,808466521,c,a,i),t)}))}destroy(){this.checkAlive(),this.inst._Image_destory(this.ptr),this.ptr=0}getSymbols(){this.checkAlive();const t=this.inst._Image_get_symbols(this.ptr);return h.createSymbolsFromPtr(t,this.inst.HEAPU8.buffer)}}class R extends _{static create(){return t(this,void 0,void 0,(function*(){const t=yield o();return new this(t._ImageScanner_create(),t)}))}destroy(){this.checkAlive(),this.inst._ImageScanner_destory(this.ptr),this.ptr=0}setConfig(t,e,r){return this.checkAlive(),this.inst._ImageScanner_set_config(this.ptr,t,e,r)}enableCache(t=!0){this.checkAlive(),this.inst._ImageScanner_enable_cache(this.ptr,t)}recycleImage(t){this.checkAlive(),this.inst._ImageScanner_recycle_image(this.ptr,t.getPointer())}getResults(){this.checkAlive();const t=this.inst._ImageScanner_get_results(this.ptr);return h.createSymbolsFromPtr(t,this.inst.HEAPU8.buffer)}scan(t){return this.checkAlive(),this.inst._ImageScanner_scan(this.ptr,t.getPointer())}}const d=()=>t(void 0,void 0,void 0,(function*(){const t=yield R.create();return t.setConfig(s.ZBAR_NONE,a.ZBAR_CFG_BINARY,1),t}));let m;const p=(e,r)=>t(void 0,void 0,void 0,(function*(){void 0===r&&(r=m||(yield d()),m=r);const t=r.scan(e);if(t<0)throw Error("Scan Failed");return 0===t?[]:e.getSymbols()})),y=(e,r,n,i)=>t(void 0,void 0,void 0,(function*(){const t=yield l.createFromGrayBuffer(r,n,e),o=yield p(t,i);return t.destroy(),o})),B=(e,r,n,i)=>t(void 0,void 0,void 0,(function*(){const t=yield l.createFromRGBABuffer(r,n,e),o=yield p(t,i);return t.destroy(),o})),E=(e,r)=>t(void 0,void 0,void 0,(function*(){return yield B(e.data.buffer,e.width,e.height,r)})),g=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{a as ZBarConfigType,l as ZBarImage,c as ZBarOrientation,R as ZBarScanner,h as ZBarSymbol,s as ZBarSymbolType,d as getDefaultScanner,o as getInstance,y as scanGrayBuffer,E as scanImageData,B as scanRGBABuffer};
//# sourceMappingURL=index.mjs.map
